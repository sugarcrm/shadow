language: php
sudo: yes
php:
  - '7.3'
dist: bionic

before_script:
  - phpenv rehash
  - php-config --extension-dir
  - phpize
  - ./configure
  - make
  - sed -i.stock -r -e 's/!mail_qa_team\(\$[[:alnum:]_]+,[[:space:]]*\$[[:alnum:]_]+,[[:space:]]*\$[[:alnum:]_]+\)/true/' run-tests.php
  - sed -i.stock -e 's/run-tests\.php/run-tests.php --show-diff/' Makefile

script:
  - REPORT_EXIT_STATUS=1 NO_INTERACTION=1 make test

notifications:
  email:
    recipients:
      - zac@sugarcrm.com
    on_success: change
    on_failure: always
